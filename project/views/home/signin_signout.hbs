<head>
    <title>{{{title}}}</title>
    <link rel="stylesheet" href="/css/signin_signout.css" />
</head>

<section class="auth-section" style="background: url('{{background}}')">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                <div class="auth-container">
                    <div class="login-wrap">
                        <!-- Form Đăng Nhập -->
                        <div id="login-form">
                            <h3>Đăng Nhập</h3>
                            <p class="subtitle">Chào mừng bạn quay trở lại</p>
                            <form class="signin-form">
                                <div class="form-group">
                                    <label for="login-email" class="label">Email</label>
                                    <div class="input-wrapper">
                                        <input id="login-email" type="email" class="form-control" placeholder="example@email.com" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="login-password" class="label">Mật khẩu</label>
                                    <div class="input-wrapper">
                                        <input id="login-password" type="password" class="form-control" placeholder="Nhập mật khẩu" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn-primary">Đăng Nhập</button>
                                </div>
                                <div class="form-links">
                                    <a href="#" id="forgot-password-link">Quên mật khẩu?</a>
                                    <span class="divider">|</span>
                                    <a href="#" id="register-link">Tạo tài khoản mới</a>
                                </div>
                            </form>
                        </div>

                        <!-- Form Đăng Ký -->
                        <div id="register-form">
                            <h3>Đăng Ký</h3>
                            <p class="subtitle">Tạo tài khoản mới của bạn</p>
                            <form class="signup-form">
                                <div class="form-group">
                                    <label for="register-name" class="label">Họ và tên</label>
                                    <input name="hoten" id="register-name" type="text" class="form-control" placeholder="Nguyễn Văn A" required>
                                </div>
                                <div class="form-group">
                                    <label for="register-email" class="label">Email</label>
                                    <input name="email" id="register-email" type="email" class="form-control" placeholder="example@email.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="register-password" class="label">Mật khẩu</label>
                                    <input name="password" id="register-password" type="password" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn-primary">Tạo Tài Khoản</button>
                                </div>
                                <div class="form-links">
                                    <a href="#" id="login-link-from-register">Đã có tài khoản? Đăng nhập</a>
                                </div>
                            </form>
                        </div>

                        <!-- Form Quên Mật Khẩu -->
                        <div id="forgot-password-form">
                            <h3>Quên Mật Khẩu</h3>
                            <p class="info-text">Nhập email của bạn và chúng tôi sẽ gửi hướng dẫn đặt lại mật khẩu</p>
                            <form class="forgot-form">
                                <div class="form-group">
                                    <label for="forgot-email" class="label">Email</label>
                                    <input id="forgot-email" type="email" class="form-control" placeholder="example@email.com" required>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn-primary">Gửi Yêu Cầu</button>
                                </div>
                                <div class="form-links">
                                    <a href="#" id="login-link-from-forgot">Quay lại Đăng nhập</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');

        const registerLink = document.getElementById('register-link');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const loginLinkFromRegister = document.getElementById('login-link-from-register');
        const loginLinkFromForgot = document.getElementById('login-link-from-forgot');

        function showForm(formToShow) {
            loginForm.style.display = 'none';
            registerForm.style.display = 'none';
            forgotPasswordForm.style.display = 'none';

            formToShow.style.display = 'block';
            formToShow.classList.add('fade-in');
        }

        registerLink.addEventListener('click', function(e) {
            e.preventDefault();
            showForm(registerForm);
        });

        forgotPasswordLink.addEventListener('click', function(e) {
            e.preventDefault();
            showForm(forgotPasswordForm);
        });

        loginLinkFromRegister.addEventListener('click', function(e) {
            e.preventDefault();
            showForm(loginForm);
        });

        loginLinkFromForgot.addEventListener('click', function(e) {
            e.preventDefault();
            showForm(loginForm);
        });

        // Xử lý submit form
        // Gửi đăng ký
        document.querySelector('.signup-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const data = {
                hoten: document.getElementById('register-name').value,
                email: document.getElementById('register-email').value,
                password: document.getElementById('register-password').value
            };

            const res = await fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await res.json();

            alert(result.message);

            if (result.status === 'success') {
                // Chuyển về đăng nhập
                showForm(loginForm);
            }
        });
        document.querySelector('.signin-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-password').value
            };

            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await res.json();

            alert(result.message);

            if (result.status === 'success') {
                window.location.href = '/admin';
            }
        });


    });
</script>